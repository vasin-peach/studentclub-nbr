webpackJsonp([11],{"1/oy":function(t,n){},"9M+g":function(t,n){},IcnI:function(t,n,e){"use strict";var o=e("7+uW"),a=e("NYxO"),i={state:{loading:{full:!1,half:!1}},getters:{getLoading:function(t){return t.loading}},mutations:{fullLoadingChange:function(t,n){t.loading.full?setTimeout(function(){t.loading.full=n},500):t.loading.full=n},halfLoadingChange:function(t,n){t.loading.half?setTimeout(function(){t.loading.half=n},500):t.loading.half=n}}},u=e("//Fk"),c=e.n(u),s=e("mtWM"),r=e.n(s),l=e("e7x4"),d=e.n(l),p=e("ytdl"),f=e.n(p),h=e("YaEn");r.a.defaults.withCredentials=!0;var m={headers:{"Content-Type":"application/json"},timeout:0},g={state:{user:{studentId:null,token:null,permission:null}},getters:{getUser:function(t){return t.user}},actions:{session:function(t){var n=t.commit;return new c.a(function(t,e){n("fullLoadingChange",!0);r.a.get(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/session","",{headers:{"Content-Type":"application/json"},timeout:0}).then(function(e){200==e.status&&(n("updateUserState",e.data.token),n("fullLoadingChange",!1),t(e))})})},checkTokenExpired:function(t,n){t.commit;return new c.a(function(t,e){var o={headers:{"Content-Type":"application/json","x-access-token":n},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/auth/check",{token:n},o).then(function(n){t(n)}).catch(function(t){e(t)})})},login:function(t,n){var e=t.commit;e("fullLoadingChange",!0),r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/auth/token",n,m).then(function(t){t.data.success&&d()({type:"success",title:"Authentication",text:"ทำการเข้าสู่ระบบด้วย รหัสนักเรียน: "+n.studentId,timer:3e3}),e("updateUserState",t.data.token),e("fullLoadingChange",!1),h.a.push({name:"Student_Club"})}).catch(function(t){var o=t.response.data;return"Authentication failed. User not found."==o.message?(e("fullLoadingChange",!1),void d()({type:"error",title:"Authentication",text:"ไม่พบรหัสนักเรียน: "+n.studentId,timer:3e3})):"Authentication failed. Wrong password."==o.message?(e("fullLoadingChange",!1),void d()({type:"error",title:"Authentication",text:"รหัสผ่านไม่ถูกต้อง",timer:3e3})):void("server refund student to logged in."==o.message?(e("fullLoadingChange",!1),d()({type:"warning",title:"Authentication",text:"เว็บยังไม่เปิดให้นักเรียนลงทะเบียนชุมนุม",timer:3e3})):(e("fullLoadingChange",!1),d()({type:"error",title:"Authentication",text:"เกิดเหตุขัดข้อง กรุณาลองใหม่อีกครั้งภายหลัง",timer:3e3})))})},logout:function(t){(0,t.commit)("updateUserState",null),r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/auth/logout","",m).then(function(t){h.a.push({name:"Login"})})},userUpdate:function(t,n){var e=t.commit,o=this.getters.getUser.token;if(n&&o)return new c.a(function(t,a){e("halfLoadingChange",!0);var i={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":o},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/auth/update",{payload:n},i).then(function(n){200==n.status?(t(n),e("halfLoadingChange",!1)):(a(),e("halfLoadingChange",!1))})})},userSelf:function(t,n){var e=t.commit;return new c.a(function(t,o){if(!n)return o();var a={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":n},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/auth/self",null,a).then(function(n){if(200==n.status)return e("updateUserProfile",n.data.data),t(n)}).catch(function(t){return o(t.response)})})}},mutations:{updateUserState:function(t,n){if(n){var e=f()(n);t.user.token=n,t.user.studentId=e.studentId,t.user.permission=e.permission}else t.user.token=null,t.user.studentId=null,t.user.permission=null},updateUserProfile:function(t,n){t.user.profile=n||null}}};r.a.defaults.withCredentials=!0;var w={state:{club:null},getters:{getClubAll:function(t){return t.club},getClubRange:function(t){return function(n,e){if(t.club)return t.club.slice(n,e)}}},actions:{clubGet:function(t,n){var e=t.commit;return new c.a(function(t,o){e("halfLoadingChange",!0);var a={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":n},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/club/get","",a).then(function(n){200==n.status?(e("updateClubData",n.data.data),t(n),e("halfLoadingChange",!1)):(o(),e("halfLoadingChange",!1))}).catch(function(t){o(t.response)})})},clubUpdateCurrent:function(t,n){var e=t.commit;return new c.a(function(t,o){if(n.name&&n.amount&&n.token){e("halfLoadingChange",!0);var a={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":n.token},timeout:0},i={amount:n.amount,name:n.name};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/club/update/current",i,a).then(function(n){200==n.status?(t(n),e("halfLoadingChange",!1)):(o(),e("halfLoadingChange",!1))}).catch(function(t){return d()({type:"error",title:"ปฎิเสธการดำเนินการ",text:"มีผู้สมัครชุมนุมแทรก ระหว่างที่คุณกำลังดำเนินการ, กรุณารีเฟรชหน้า"}),o()})}})},clubRemove:function(t,n){var e=t.commit;return new c.a(function(t,o){if(!n.token)return o();e("halfLoadingChange",!0);var a={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":n.token},timeout:0},i={name:n.name};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/club/remove",i,a).then(function(n){200==n.data.code?t(n):o(n)}).catch(function(t){o(t)})})},clubAdd:function(t,n){var e=t.commit;return new c.a(function(t,o){if(!n.token||!n.data)return o();e("halfLoadingChange",!0);var a={headers:{"Content-Type":"application/json","Access-Control-Allow-Headers":"x-access-token","x-access-token":n.token},timeout:0},i=[];for(var u in n.data.prefix)i.push({prefix:n.data.prefix[u],firstname:n.data.firstname[u],lastname:n.data.lastname[u]});var c=new FileReader;c.readAsDataURL(n.data.img),c.onloadend=function(){var u=c.result,s={entry:{max:n.data.max},owner:i,receive:n.data.receive,name:n.data.name,img:u,desc:n.data.desc};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/club/add",s,a).then(function(n){return t(n),e("halfLoadingChange",!1)}).catch(function(t){return o(t.response),e("halfLoadingChange",!1)})}})}},mutations:{updateClubData:function(t,n){t.club=n||"empty"}}},C=e("2aIq"),v=e.n(C),b=e("fZjL"),L=e.n(b);r.a.defaults.withCredentials=!0;var k={state:{userSize:0,userList:null,clubList:null},getters:{getUserList:function(t){return t.userList},getUserSize:function(t){return t.userSize},getClubList:function(t){return t.clubList}},mutations:{updateUserList:function(t,n){n?(t.userSize=n.count,t.userList=n.users):(t.userSize=0,t.userList=null)},updateClubList:function(t,n){t.clubList=n||null},updateClubUser:function(t,n){L()(t.clubList).forEach(function(e){t.clubList[e].student=n.filter(function(n){return t.clubList[e].name==n.club})})}},actions:{webEnabledState:function(t,n){return v()(t),new c.a(function(t,e){r.a.get(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/status/enabled",n,{headers:{"Content-Type":"application/json"},timeout:0}).then(function(n){return t(n.data.data.enabled)}).catch(function(t){return e(t.response)})})},webEnabled:function(t,n){t.commit;return new c.a(function(t,e){var o={headers:{"Content-Type":"application/json","x-access-token":n.token},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/option/enabled",n,o).then(function(t){})})},findUserByClub:function(t,n){var e=t.commit;return new c.a(function(t,o){var a={headers:{"Content-Type":"application/json","x-access-token":n.token},timeout:0},i={data:[],token:n.token};n.data.forEach(function(t,n){i.data[n]=t.name}),r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/user/club",i,a).then(function(n){return e("updateClubUser",n.data.data),e("fullLoadingChange",!1),t(n)}).catch(function(t){return e("fullLoadingChange",!1),o(t)})})},reqAllUser:function(t,n){var e=t.commit;return new c.a(function(t,o){e("fullLoadingChange",!0);var a={headers:{"Content-Type":"application/json","x-access-token":n},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/user/all",{token:n},a).then(function(n){return e("updateUserList",n.data),e("fullLoadingChange",!1),t(n)}).catch(function(t){return e("fullLoadingChange",!1),o(t)})})},reqAllClub:function(t,n){var e=t.commit,o=t.dispatch;return new c.a(function(t,a){e("fullLoadingChange",!0);var i={headers:{"Content-Type":"application/json","x-access-token":n},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/club/all",{token:n},i).then(function(i){e("updateClubList",i.data.clubs),o("findUserByClub",{token:n,data:i.data.clubs}).then(function(n){return t(n)}).catch(function(t){return e("fullLoadingChange",!1),a(t)})}).catch(function(t){return e("fullLoadingChange",!1),a(t)})})},userRemove:function(t,n){var e=t.commit;return new c.a(function(t,o){e("fullLoadingChange",!0);var a={headers:{"Content-Type":"application/json","x-access-token":n.token},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/user/remove",{data:n},a).then(function(n){return e("fullLoadingChange",!1),t(n)}).catch(function(t){return e("fullLoadingChange",!1),o(t)})})},userAdd:function(t,n){var e=t.commit;return new c.a(function(t,o){e("fullLoadingChange",!0);var a={headers:{"Content-Type":"application/json","x-access-token":n.token},timeout:0};r.a.post(window.location.protocol+"//"+window.location.host.split(":")[0]+":3000/api/teacher/user/add",{data:n},a).then(function(n){return e("fullLoadingChange",!1),t(n)}).catch(function(t){return e("fullLoadingChange",!1),o(t)})})}}};o.a.use(a.a);n.a=new a.a.Store({modules:{teacher:k,auth:g,club:w,loading:i},strict:!1})},Id91:function(t,n){},Jmt5:function(t,n){},NHnr:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("7+uW"),a=e("Dd8w"),i=e.n(a),u=e("NYxO"),c={name:"App",mounted:function(){},computed:i()({},Object(u.e)(["loading"])),methods:{}},s={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[e("transition",{attrs:{name:"app-fade",mode:"out-in"}},[t.loading.loading.full?e("div",[e("div",{staticClass:"loading-wrapper"},[e("div",{staticClass:"loading-fade"}),t._v(" "),e("div",{staticClass:"loading-block"},[e("div",{staticClass:"text-center"},[e("i",{staticClass:"fas fa-spinner fa-spin"}),e("br"),t._v(" "),e("span",[t._v("L")]),t._v(" "),e("span",[t._v("O")]),t._v(" "),e("span",[t._v("A")]),t._v(" "),e("span",[t._v("D")]),t._v(" "),e("span",[t._v("I")]),t._v(" "),e("span",[t._v("N")]),t._v(" "),e("span",[t._v("G")]),t._v(" "),e("span",[t._v(".")]),t._v(" "),e("span",[t._v(".")])])])])]):e("transition",{attrs:{name:"app-fade",mode:"out-in"}},[e("router-view")],1)],1)],1)},staticRenderFns:[]};var r=e("VU/8")(c,s,!1,function(t){e("nwEP")},null,null).exports,l=e("e6fC"),d=e("sUu7"),p=e("YaEn"),f=e("IcnI");e("NP2u"),e("Jmt5"),e("9M+g");o.a.use(d.b,{fieldsBagName:"veeFields"}),o.a.use(l.a),o.a.config.productionTip=!1,new o.a({el:"#app",router:p.a,store:f.a,components:{App:r},template:"<App/>"})},NP2u:function(t,n){},YaEn:function(t,n,e){"use strict";var o=e("7+uW"),a=e("/ocq"),i=e("IcnI"),u=e("mtWM"),c=(e.n(u),e("ytdl")),s=e.n(c);o.a.use(a.a);var r=new a.a({mode:"history",routes:[{path:"/",component:function(){return e.e(6).then(e.bind(null,"fYsj"))},children:[{path:"/404",component:function(){return e.e(7).then(e.bind(null,"96Mb"))},name:"Notfound"},{path:"/login",component:function(){return e.e(5).then(e.bind(null,"KoTh"))},name:"Login",alias:"/",meta:{noAuth:!0}},{path:"/logout",component:function(){return e.e(9).then(e.bind(null,"3KYm"))},name:"Logout",meta:{auth:!0}},{path:"/student",component:function(){return e.e(3).then(e.bind(null,"6J1u"))},meta:{auth:!0},children:[{path:"club",component:function(){return e.e(8).then(e.bind(null,"gXr3"))},name:"Student_Club",alias:"/"}]},{path:"/teacher",component:function(){return e.e(4).then(e.bind(null,"wNcZ"))},meta:{auth:!0,teacher:!0},children:[{path:"user",component:function(){return e.e(1).then(e.bind(null,"BED9"))},name:"Teacher_User",alias:"/"},{path:"club",component:function(){return e.e(0).then(e.bind(null,"qNwO"))},name:"Teacher_Club"},{path:"option",component:function(){return e.e(2).then(e.bind(null,"jbj8"))},name:"Teacher_Option"}]}]}]});r.beforeEach(function(t,n,o){t.matched.length?o():o({name:"Notfound"}),i.a.dispatch("session").then(function(n){n.data.token&&i.a.dispatch("checkTokenExpired",n.data.token).then(function(t){}).catch(function(t){new Promise(function(t){t()}).then(e.bind(null,"e7x4")).then(function(){i.a.dispatch("logout"),r.push({name:"Login"})})});var a=i.a.getters.getUser;if(i.a.dispatch("userSelf",a.token).catch(function(t){}),t.matched.some(function(t){return t.meta.noAuth})&&a.token)o({name:"Student_Club"});else if(!t.matched.some(function(t){return t.meta.auth})||a.token)if(t.matched.some(function(t){return t.meta.teacher})&&s()(a.token).permission<2)o({name:"Student_Club"});else{if(t.path.indexOf("teacher")>=1&&t.path.indexOf("user")>=1){if(i.a.getters.getUserList)return!1;i.a.dispatch("reqAllUser",a.token)}if(t.path.indexOf("teacher")>=1&&t.path.indexOf("club")>=1){if(i.a.getters.getClubList)return!1;i.a.dispatch("reqAllClub",a.token)}}else o({name:"Login"})})}),n.a=r},nwEP:function(t,n){},zj2Q:function(t,n){}},["NHnr"]);
//# sourceMappingURL=app.7de913b6063236f4567e.js.map